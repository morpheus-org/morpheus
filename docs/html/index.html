<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Morpheus: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Morpheus<span id="projectnumber">&#160;0.4.0</span>
   </div>
   <div id="projectbrief">Dynamic matrix type and algorithms for sparse matrices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__Users_cstyl_Desktop_code_morpheus_README"></a> Sparse matrices are a key component of the performance critical computations in many numerical simulations. A desire to represent sparse matrices efficiently in memory and optimise , in particular given the evolution of hardware architectures, has over the years led to the development of a plethora of sparse matrix storage formats. Each format is designed to exploit the particular strengths of an architecture or the specific sparsity pattern of a matrix. The choice of the format can be crucial in order to achieve optimal performance. Being able to dynamically select storage formats at runtime is therefore highly desirable.</p>
<p ><code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code>, is a library of sparse matrix storage formats that is designed for efficient and transparent format switching across architectures without introducing prohibitive overheads and that, at the same time, enables the straightforward addition of new storage formats without major application code changes. The library has a functional design which separates the containers that implement the storage formats from the algorithm that implement operations such as multiplication. Each container is aware of the memory space it resides in, and the algorithms require knowledge of the execution space that they will be running in. This design allows <a class="el" href="namespaceMorpheus.html">Morpheus</a> to target multiple heterogeneous architectures.</p>
<p >To enable efficient yet flexible dynamic switching, <a class="el" href="namespaceMorpheus.html">Morpheus</a> uses the <code>std::variant</code> introduced in C++17 - hence it requires a <b>C++17</b> compliant compiler - as a type-safe union. It offers a polymorphic variable called <code>DynamicMatrix</code> which abstracts the notion of sparse matrix storage formats away from users and can hold any of the supported formats internally.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<p >A very basic installation using CMake is done with:</p>
<div class="fragment"><div class="line">$ cmake ${srcdir} \</div>
<div class="line">   -DCMAKE_CXX_COMPILER=g++ \</div>
<div class="line">   -DCMAKE_INSTALL_PREFIX=${my_install_folder}</div>
<div class="line">   -DKokkos_ROOT=${kokkos_install_prefix}</div>
<div class="line">$ make</div>
<div class="line">$ make install</div>
</div><!-- fragment --><p >which configures, builds and installs a default <a class="el" href="namespaceMorpheus.html">Morpheus</a>. Note that <code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code> <b>REQUIRES</b> <a href="https://github.com/kokkos/kokkos">Kokkos</a> to be installed. Note that <code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code> inherits the enabled devices and compiler optimization flags from <code>Kokkos</code>.</p>
<p >Once <a class="el" href="namespaceMorpheus.html">Morpheus</a> is installed In your <code>CMakeLists.txt</code> simply use:</p>
<div class="fragment"><div class="line">find_package(Morpheus REQUIRED)</div>
</div><!-- fragment --><p >Then for every executable or library in your project: </p><div class="fragment"><div class="line">target_link_libraries(myTarget Morpheus::morpheus)</div>
</div><!-- fragment --><p >More information can be found at BUILD.md</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p >Currently <code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code> is under development so no documentation is available yet. Examples in <code>examples/</code> and <code>core/examples</code> can be a good source of information.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Supported Formats</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Format   </th><th class="markdownTableHeadNone">Container   </th><th class="markdownTableHeadNone">Serial   </th><th class="markdownTableHeadNone">OpenMP   </th><th class="markdownTableHeadNone">CUDA   </th><th class="markdownTableHeadNone">HIP   </th><th class="markdownTableHeadNone">Kokkos    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Coo   </td><td class="markdownTableBodyNone">CooMatrix   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">no   </td><td class="markdownTableBodyNone">no    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Csr   </td><td class="markdownTableBodyNone">CsrMatrix   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">no   </td><td class="markdownTableBodyNone">yes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Dia   </td><td class="markdownTableBodyNone">DiaMatrix   </td><td class="markdownTableBodyNone">tes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">yes   </td><td class="markdownTableBodyNone">no   </td><td class="markdownTableBodyNone">yes   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md4"></a>
Specifying a container</h2>
<p >To define a container we need to specify four template parameters:</p><ul>
<li><code>ValueType</code>: The type of the values the container will hold. Valid types must satisfy <code>std::is_arithmetic</code> i.e to be an arithmetic type.</li>
<li><code>IndexType</code>: The type of the indices the container will hold. Valid types must satisfy <code>std::is_integral</code> i.e to be an integral type.</li>
<li><code>Layout</code>: Orientation of data in memory. Valid layouts are either <code>Kokkos::LayoutLeft</code> (Column-Major) or <code>Kokkos::LayoutRight</code> (Row-Major).</li>
<li><code>Space</code>: A memory or execution space supported by Kokkos. Valid <em>Memory</em> Spaces are <code>Kokkos::HostSpace</code>, <code>Kokkos::CudaSpace</code> and <code>Kokkos::HipSpace</code>. Valid <em>Execution</em> Spaces are <code>Kokkos::Serial</code>, <code>Kokkos::OpenMP</code>, <code>Kokkos::Cuda</code> and <code>Kokkos::HIP</code>. Note that specifying the execution space will determine in which space each member function will be executed. By not providing a space parameter <code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code> will choose a default one for you.</li>
</ul>
<p >Note that only <code>ValueType</code> is mandatory. For the rest of the arguments, if not provided, sensible defaults will be selected.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Morpheus_Core.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * ValueType        : double</span></div>
<div class="line"><span class="comment">     * IndexType        : long long</span></div>
<div class="line"><span class="comment">     * Layout           : Kokkos::LayoutRight</span></div>
<div class="line"><span class="comment">     * MemorySpace      : Kokkos::HostSpace </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    Morpheus::CooMatirx&lt;double, long long, Kokkos::LayoutRight, Kokkos::HostSpace&gt; A;  </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * ValueType        : double</span></div>
<div class="line"><span class="comment">     * IndexType        : int (Default)</span></div>
<div class="line"><span class="comment">     * Layout           : Kokkos::LayoutRight (Default), </span></div>
<div class="line"><span class="comment">     * MemorySpace      : Kokkos::DefaultSpace (Default) </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    Morpheus::CsrMatirx&lt;double&gt; B; </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Using an Algorithm</h2>
<p >For each algorithm the same interface is used across different formats. Algorithms are aware of the execution space they will be executed in and dispatch depends on that too. Currently we support the following algorithms for each of the supported storage formats:</p><ul>
<li>Multiply (Sparse Matrix-Vector Multiplication)</li>
<li>Copy</li>
<li>Convert</li>
<li>Print</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Morpheus_Core.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">// [ 3.5   *   * ]</span></div>
<div class="line">    <span class="comment">// [  *   1.5  * ]</span></div>
<div class="line">    Morpheus::CooMatirx&lt;double,  Kokkos::HostSpace&gt; A(2, 3, 2);  </div>
<div class="line">    <a class="code hl_class" href="classMorpheus_1_1DenseVector.html">Morpheus::DenseVector&lt;double,  Kokkos::HostSpace&gt;</a> x(3, 0), y(2, 0); </div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initializing A</span></div>
<div class="line">    A.row_indices[0] = 0;</div>
<div class="line">    A.column_indices[0] = 0;</div>
<div class="line">    A.values[0] = 3.5;</div>
<div class="line"> </div>
<div class="line">    A.row_indices[1] = 1;</div>
<div class="line">    A.column_indices[1] = 1;</div>
<div class="line">    A.values[1] = 1.5;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initializing x</span></div>
<div class="line">    x[0] = 1; x[1] = 2; x[2] = 3;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// y = A * x</span></div>
<div class="line">    Morpheus::Multiply&lt;Kokkos::Serial&gt;(A, x, y);</div>
<div class="line">}</div>
<div class="ttc" id="aclassMorpheus_1_1DenseVector_html"><div class="ttname"><a href="classMorpheus_1_1DenseVector.html">Morpheus::DenseVector</a></div><div class="ttdoc">The DenseVector container is a one-dimensional container that contains contiguous elements....</div><div class="ttdef"><b>Definition:</b> Morpheus_DenseVector.hpp:96</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Use of dynamic matrix</h2>
<p >The dynamic matrix tries to absrtract away the different supported formats and provide an efficient yet flexible switching mechanism between them. The dynamic matrix follows the same interface as the other containers hence algorithms can be used in the same way.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Morpheus_Core.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    Morpheus::DynamicMatirx&lt;double&gt; A;  <span class="comment">// Default format is COO</span></div>
<div class="line"> </div>
<div class="line">    A.activate(Morpheus::CSR_FORMAT)    <span class="comment">// Active type now is CSR</span></div>
<div class="line"> </div>
<div class="line">    A.activate(Morpheus::DIA_FORMAT)    <span class="comment">// Active type now is DIA</span></div>
<div class="line"> </div>
<div class="line">    A.activate(0)    <span class="comment">// Active type now is the first in the DynamicMatrix</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Building and Running the Tests and Examples</h1>
<p >Building the tests and examples requires the <a href="https://github.com/google/googletest">GTest</a> testing framework, which ships together with <code><a class="el" href="namespaceMorpheus.html">Morpheus</a></code>.</p>
<p >To build and run the tests add the <code>-DMorpheus_ENABLE_TESTS=On</code> during configuration stage respectively. Note that tests for different devices are enabled based on how <code>Kokkos</code> was configured.</p>
<p >After configuration, to build and run the <code>Serial</code> tests do: </p><div class="fragment"><div class="line">$ cd  ${srcdir}</div>
<div class="line">$ make MorpheusCore_UnitTest_Serial</div>
<div class="line">$ ${srcdir}/core/tests/MorpheusCore_UnitTest_Serial</div>
</div><!-- fragment --><p> Same process can be followed for <code>OpenMP</code>, <code>Cuda</code> and <code>HIP</code>.</p>
<p >To build and run all the available tests then do: </p><div class="fragment"><div class="line">$ cd  ${srcdir}</div>
<div class="line">$ make MorpheusCore_UnitTest</div>
<div class="line">$ ${srcdir}/core/tests/MorpheusCore_UnitTest</div>
</div><!-- fragment --><p> To build and run the examples add the <code>-DMorpheus_ENABLE_EXAMPLES=On</code> during configuration. Similar process is followed as building the tests.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
License</h1>
<p >This software is licensed under the Apache License, Version 2.0. See the [LICENSE](LICENSE) file for details. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
